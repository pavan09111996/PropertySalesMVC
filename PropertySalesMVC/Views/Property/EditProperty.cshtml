@model EditPropertyViewModel
@{
    ViewData["Title"] = "Edit Property";
}
<link href="~/css/property-update.css" rel="stylesheet" />
<div class="edit-property-container">
    <h2>Edit Property</h2>
    <p class="edit-subtitle">Update property details and manage images</p>

    <form asp-action="EditProperty"
          asp-controller="Property"
      method="post"
      enctype="multipart/form-data">

    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="PropertyId" />
        <hr class="form-divider">
    <div class="form-group mb-3">
        <label>Title</label>
        <input asp-for="Title" class="form-control" />
    </div>
        <hr class="form-divider">
    <div class="form-group mb-3">
        <label>Location</label>
        <input asp-for="Location" class="form-control" />
    </div>
        <hr class="form-divider">
    <div class="form-group mb-3">
        <label>Price</label>
        <input asp-for="Price" class="form-control" />
    </div>
        <hr class="form-divider">
    <div class="form-group mb-3">
        <label>Description</label>
        <textarea asp-for="Description"
                  class="form-control"
                  rows="4"></textarea>
    </div>
        <hr class="form-divider">
    <!-- EXISTING IMAGES -->
    <div class="mb-4">
        <label class="fw-bold">Existing Images</label>
            <div id="imagePreviewContainer" class="existing-images">
                <div id="imagePreviewContainer" class="existing-images">

                    @foreach (var img in Model.ExistingImages)
{
    <div class="existing-image-card">
        <img src="data:image/jpeg;base64,@img.ImageBase64" />

        <button type="button"
                class="remove-image-btn"
                onclick="markExistingImageForRemoval(this)">
            ×
        </button>

        <!-- IMPORTANT: real ImageId -->
        <input type="hidden"
               name="RemoveImageIds"
               value="@img.ImageId"
               disabled />
    </div>
}

                </div>
            </div>
    </div>

     <input type="file"
           id="newImagesInput"
           name="NewImages"
           multiple
           accept="image/*"
           onchange="previewNewImages(this)" />

    <div id="imagePreviewContainer" class="existing-images"></div>
        <button class="btn-save">Update Property</button>
        <a class="btn-cancel">Cancel</a>

</form>
</div>

<script>

function previewNewImages(input) {
    if (!input.files || input.files.length === 0) return;

    const container = document.getElementById("imagePreviewContainer");

    // DO NOT clear container if you want additive preview
    Array.from(input.files).forEach(file => {
        if (!file.type.startsWith("image/")) return;

        const reader = new FileReader();
        reader.onload = e => {
            const div = document.createElement("div");
            div.className = "existing-image-card new-image";

            const img = document.createElement("img");
            img.src = e.target.result;

            div.appendChild(img);
            container.appendChild(div);
        };
        reader.readAsDataURL(file);
    });

    // 🚫 DO NOT reset input.value
    // 🚫 DO NOT disable input
}



    function markExistingImageForRemoval(btn) {
    const card = btn.closest(".existing-image-card");
    card.classList.add("marked-for-delete");

    const hiddenInput = card.querySelector("input[type='hidden']");
    hiddenInput.disabled = false;
}
</script>
